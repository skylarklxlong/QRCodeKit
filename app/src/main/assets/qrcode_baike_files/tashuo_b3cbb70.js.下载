(function (page){ var define = page.define; var require = page.require; define("wiki-mobile-lemma:widget/tashuo/common/common.js",function(t,i,e){function o(t,i,e){this.data=i,this.$like=t.find(".J-like"),this.type=e,this.bindEvents()}function a(t,i){var e,o,a,s,n=0,h=function(){n=new Date,a=null,s=t.apply(e,o)};return function(){var l=new Date,u=i-(l-n);return e=this,o=arguments,0>=u?(clearTimeout(a),a=null,n=l,s=t.apply(e,o)):a||(a=setTimeout(h,u)),s}}var s=t("wiki-mobile-common:widget/lib/zepto/zepto.js"),n=t("wiki-mobile-common:widget/util/nslog.js");o.prototype={constructor:o,bindEvents:function(){var t=this;this.$like.on("click",function(){t.vote()})},vote:function(){s.ajax({url:page.baseUrl+"/api/tashuo/vote",dataType:"json",data:{id:this.data.tashuoId}}),this.data.isvote?(this.data.isvote=0,this.changeVoteButton(0),"dialog"===this.type?n.q2("20008011"):"list"===this.type&&n.q2("20008009")):(this.data.isvote=1,this.changeVoteButton(1),"dialog"===this.type?n.q2("20008010"):"list"===this.type&&n.q2("20008008"))},changeVoteButton:function(t){var i="tashuo-liked",e=this.$like.find(".J-number");t>0?(this.data.vote++,this.$like.addClass(i),e.text(this.data.vote)):(this.$like.removeClass(i),this.data.vote--,e.text(this.data.vote))}},e.exports={TashuoItem:o,throttle:a}});})(window._SF_ ? _SF_.page : window.page);
;(function (page){ var define = page.define; var require = page.require; define("wiki-mobile-lemma:widget/tashuo/dialog/dialog.js",function(t,i,e){var s=t("wiki-mobile-common:widget/lib/zepto/zepto.js"),a=t("wiki-mobile-common:widget/util/nslog.js"),n=t("wiki-mobile-common:widget/lib/jsmart/jsmart.js"),h=t("wiki-mobile-lemma:widget/tashuo/common/common.js"),o=new n('{%foreach $items as $index=>$item%}\n<div class="tashuo-item-el J-item">\n<div class="tashuo-item">\n<div class="tashuo-title">\n<a href="{%$baseUrl|f_escape_xml%}/tashuo/authorcenter?authorId={%$item.authorId|f_escape_path%}">\n<i><img src="{%\'http://imgsrc.baidu.com/baike/pic/item/\'|cat:$item.picSrc|cat:\'.jpg\'|wiki_common_https_trans%}" /></i>\n<div><strong>{%$item.name|f_escape_xml%}</strong>\n<p>{%$item.nameDesc|f_escape_xml%}</p>\n</div>\n</a>\n</div>\n<div class="tashuo-content-el">\n<div class="tashuo-content">\n<div class="tashuo-content-inner"><a href="{%$baseUrl|f_escape_xml%}/tashuo/browse/content?id={%$item.id|f_escape_path%}&fromLemmaModule=dialog&lemmaId={%$lemmaId|f_escape_path%}">{%if $item.abstract%}{%$item.abstract|f_escape_xml%}{%else%}{%$item.title|f_escape_xml%}{%/if%}{%if $item.extData.writer%}<span class="tashuo-item-content-author">（作者：{%$item.extData.writer|f_escape_xml%}）</span>{%else%}<i class="tashuo-icon-original">原创</i>{%/if%}</a></div>\n</div>\n<div class="tashuo-content-more"><a href="{%$baseUrl|f_escape_xml%}/tashuo/browse/content?id={%$item.id|f_escape_path%}&fromLemmaModule=dialog&lemmaId={%$lemmaId|f_escape_path%}">阅读全文</a></div>\n</div>\n<div class="tashuo-operator">\n<span class="tashuo-operator-item J-like {%if $item.isvote%}tashuo-liked{%/if%}"><i></i><span class="J-number">{%$item.vote|f_escape_xml%}</span></span>\n</div>\n</div>\n</div>\n{%/foreach%}'),m=new n('<div class="tashuo-items-loading">\n<i></i>\n</div>'),c=new n('<div id="tashuo_dialog" class="tashuo-dialog">\n<div class="tashuo-mask J-mask"></div>\n<div class="tashuo-container J-container">\n<div class="tashuo-caption-title"></div>\n<div class="tashuo-closer J-closer"><i></i></div>\n<div class="tashuo-items-container">\n<div class="tashuo-items-el J-items">\n</div>\n</div>\n</div>\n</div>'),d=s(window),l=s(".BK-main-content"),r={},f={currentIndex:0,init:function(t){var i=this;this.lemmaId=t.lemmaId,l.on("tashuoDialog",function(t,e){i.show(),i.getData(e.tagData)})},getData:function(t){var i=this,e=[];return s.each(t,function(t,i){e.push(i.id)}),r[e.join("-")]?(this.data=r[e.join("-")],void this.compileDataToHtml()):void s.ajax({url:page.baseUrl+"/api/tashuo/gettashuobyids",type:"POST",dataType:"json",data:{ids:e.join(",")},success:function(t){0===t.error&&t.data&&t.data.length>0?(i.data=t.data,r[e.join("-")]=i.data,i.compileDataToHtml()):i.hide()},error:function(){i.hide()}})},show:function(){this.hasDistance=!0,this.$el?(this.$el.show(),this.$items.html(m.fetch()),this.setTopDistance()):(this.$el=s(c.fetch()),this.$el.appendTo(window._SF_?"b-superframe-body #J-lemma":document.body),this.setElements(),this.$items.html(m.fetch()),this.bindEvents(),this.setTopDistance()),this.$mask.css("height",d.height()+"px"),a.q2("20008002")},hide:function(){this.$items.html(""),this.$el.hide(),this.$closer.hide(),this.$items.css({width:"100%",left:0}).html(""),this.hasDistance=!1},setElements:function(){this.$container=this.$el.find(".J-container"),this.$items=this.$el.find(".J-items"),this.$closer=this.$el.find(".J-closer"),this.$mask=this.$el.find(".J-mask")},bindEvents:function(){var t=this;this.$el.on("click",function(t){t.stopPropagation()}),this.$el.find(".J-items").swipeLeft(function(){t.data.length>0&&(t.swipeSlide("left"),a.q2("20008003"))}),this.$el.find(".J-items").swipeRight(function(){t.data.length>0&&(t.swipeSlide("right"),a.q2("20008003"))}),this.$closer.on("click",function(){t.hide()}),this.$mask.on("click",function(){t.hide()}),s(document.body).on("touchmove",function(i){t.hasDistance&&i.preventDefault()}),window.addEventListener("orientationchange",function(){t.hide()},!1)},setTopDistance:function(){var t=d.height(),i=this.$container.height(),e=Math.abs(parseInt(this.$closer.css("bottom"),10));this.$el.css("top",d.scrollTop()+"px"),this.$container.css("top",(t-i-e)/2+"px")},compileDataToHtml:function(){var t=this;this.$items.html(o.fetch({items:this.data,lemmaId:this.lemmaId,baseUrl:page.baseUrl||""})),this.setItemViewWidth(),this.$closer.show(),this.$items.find(".J-item").each(function(i){new h.TashuoItem(s(this),t.data[i],"dialog")})},setItemViewWidth:function(){var t=this.$items.children(),i=d.width(),e=parseInt(t.css("margin-right"),10),s=e/2,a=i-2*e;if(this.itemWidth=a,this.marginItem=e,t.css("width",a+"px"),this.initItemsLeftMargin=0,this.data.length>1){var n=parseInt(e/2+s/2,10),h=parseInt(s/2,10);this.$items.css({width:parseInt((a+e/2)*this.data.length,10),left:n}),this.initItemsLeftMargin=n,t.css({marginLeft:h,marginRight:h}),this.marginItem=h}},swipeSlide:function(t){var i=-(this.currentIndex*(this.itemWidth+2*this.marginItem)-this.initItemsLeftMargin),e=0;if("left"===t){if(this.currentIndex===this.data.length-1)return;e=i-(this.itemWidth+2*this.marginItem),this.currentIndex++}else{if(0===this.currentIndex)return;e=i+(this.itemWidth+2*this.marginItem),this.currentIndex--}this.$items.animate({left:e},300,"ease-out")},swipeSlideByIndex:function(t){var i=-(t*(this.itemWidth+2*this.marginItem)-this.initItemsLeftMargin);this.$items.animate({left:i},300,"ease-out"),this.currentIndex=t},moveBySteps:function(t){var i=parseInt(this.$items.css("left"),10);0>t&&i<=-(this.itemWidth*(this.data.length-1))+this.initItemsLeftMargin||t>0&&i>=this.initItemsLeftMargin||this.$items.css("left",i+t)}};e.exports={init:function(t){f.init(t||{})}}});})(window._SF_ ? _SF_.page : window.page);
;(function (page){ var define = page.define; var require = page.require; define("wiki-mobile-lemma:widget/tashuo/floatView/floatView.js",function(t,i,o){var s=t("wiki-mobile-common:widget/lib/zepto/zepto.js"),e=t("wiki-mobile-common:widget/util/nslog.js"),n=t("wiki-mobile-lemma:widget/content-n/content/content.js"),a=t("wiki-mobile-lemma:widget/tashuo/common/common.js"),l=s(window),h={status:"hide",init:function(t){this.config=t||{},this.$el=s("#tashuo_float_view_el"),this.$container=this.$el.find(".J-container"),this.winHeight=l.height(),this.$tashuoListEl=s("#tashuo_list"),this.isLastScreen=!1,this.bindEvents(),this.processStatus()},bindEvents:function(){var t=this,i=null,o=s(".BK-main-content"),h=!1;l.on("scroll",a.throttle(function(){t.processStatus()},300)),o.on("mainContentLoaded",function(o,s){i=s.MBK,t.isLastScreen="undefined"==typeof s.isLastScreen?i.page===i.total-1?!0:!1:s.isLastScreen}),this.$tashuoListEl.on("tashuoListShow",function(){h&&n.smoothScroll(t.$tashuoListEl.offset().top-40,1)}),this.$el.on("tap",function(){if(i.page<i.total-1){var o=1e4*(i.total-1)+(i.page+1);n.lemmaAjax(o,function(){h=!0},!0)}else n.smoothScroll(t.$tashuoListEl.offset().top-40,1);e.q2("20008007"),"test"===t.config.tashuoStyle&&e.q2("20012301")}).on("touchstart",function(t){t.preventDefault()})},processStatus:function(){var t=l.scrollTop();this.toggleFloat(this.isLastScreen&&t>this.$tashuoListEl.offset().top-this.winHeight-40?"hide":"show")},toggleFloat:function(t){t!==this.status&&(this.status=t,"show"===t?(this.$el.show(),e.q2("20008006"),"test"===this.config.tashuoStyle&&e.q2("20012300")):this.$el.hide())}};o.exports={init:function(){h.init()}}});})(window._SF_ ? _SF_.page : window.page);
;(function (page){ var define = page.define; var require = page.require; define("wiki-mobile-lemma:widget/tashuo/list/list.js",function(t,e,i){var a=t("wiki-mobile-common:widget/lib/zepto/zepto.js"),s=t("wiki-mobile-common:widget/util/nslog.js"),n=t("wiki-mobile-common:widget/lib/jsmart/jsmart.js"),o=(t("wiki-mobile-common:widget/util/cookie.js"),t("wiki-mobile-lemma:widget/content-n/content/content.js")),m=t("wiki-mobile-lemma:widget/tashuo/common/common.js"),l=t("wiki-mobile-common:widget/lib/iscroll/iscroll.min.js");n.prototype.registerPlugin("modifier","tashuoCoverAdaptSize",function(t){var e=document.body.clientWidth-30,i=160,a=t.width/t.height,s=[];return a>=e/i?(s.push("height: 100%"),s.push("margin-left: -"+(a*i-e)/2+"px")):(s.push("width: 100%"),s.push("margin-top: -"+(e/a-i)/4+"px")),s.join(";")});var c=null,h={miniCount:5,init:function(t){c=new n('{%foreach $items as $index=>$item%}\n<div class="tashuo-item J-item">\n<div class="tashuo-item-author">\n<a href="{%$baseUrl|f_escape_xml%}/tashuo/authorcenter?authorId={%$item.authorId|f_escape_path%}">\n<div class="ta-author-area">{%if $item.isAddV%}<i></i>{%/if%}<span><img src="{%\'http://imgsrc.baidu.com/baike/pic/item/\'|cat:$item.picSrc|cat:\'.jpg\'|wiki_common_https_trans%}" /></span></div>\n<div class="ta-author-slogan-area">\n<strong>{%$item.name|f_escape_xml%}</strong>\n<span>{%$item.nameDesc|f_escape_xml%}</span>\n</div>\n</a>\n</div>\n{%if $item.sharePic.src%}\n<div class="tashuo-item-cover">\n<span>\n<a href="{%$baseUrl|f_escape_xml%}/tashuo/browse/content?id={%$item.id|f_escape_path%}&lemmaId={%$lemmaId|f_escape_path%}&fromLemmaModule=list"><img src="{%\'http://imgsrc.baidu.com/baike/pic/item/\'|cat:$item.sharePic.src|cat:\'.jpg\'|wiki_common_https_trans%}" style="{%$item.sharePic|tashuoCoverAdaptSize|f_escape_xml%}" /></a>\n</span>\n{%if $voice && $voice[\'tashuo\']%}\n<div class="module-audio-play audio-play tashuo-audio" data-index="TA说-{%$index|f_escape_xml%}">\n<em class="layout-icons layout-icons_new-sound1"></em>\n</div>\n{%/if%}\n</div>\n{%/if%}\n<div class="tashuo-item-title">\n<a href="{%$baseUrl|f_escape_xml%}/tashuo/browse/content?id={%$item.id|f_escape_path%}&lemmaId={%$lemmaId|f_escape_path%}&fromLemmaModule=list">{%$item.title|f_escape_xml%}</a>\n{%if !$item.sharePic.src && $voice && $voice[\'tashuo\']%}\n<div class="module-audio-play audio-play tashuo-audio" data-index="TA说-{%$index|f_escape_xml%}">\n<em class="layout-icons layout-icons_new-sound1"></em>\n</div>\n{%/if%}\n</div>\n<div class="tashuo-item-content">\n<div class="tashuo-item-content-inner">\n<a class="J-content-link"\n               href="{%$baseUrl|f_escape_xml%}/tashuo/browse/content?id={%$item.id|f_escape_path%}&lemmaId={%$lemmaId|f_escape_path%}&fromLemmaModule=list"\n                    >{%if $item.abstract%}{%$item.abstract|f_escape_xml%}{%else%}{%$item.title|f_escape_xml%}{%/if%}</a>\n</div>\n</div>\n<div class="tashuo-item-operator">\n{%if $item.publishTime%}<span class="tashuo-item-publish-date">{%$item.publishTime|f_escape_xml%}</span>{%/if%}\n<span class="tashuo-item-like J-like new-like{%if $item.isvote%}tashuo-liked{%/if%}"><i></i><strong class="J-number">{%$item.vote|f_escape_xml%}</strong></span>\n<span class="tashuo-item-view"><i>阅读</i><strong>{%$item.pv|f_escape_xml%}</strong></span>\n</div>\n</div>\n{%/foreach%}');var e=this;this.config=t,this.lemmaId=t.lemmaId,this.$el=a("#tashuo_list"),this.voice=t.voice,e.isGetData=!1,this.inTashuoStyle="topLeft"===t.tashuoStyle,this.$el.on("tashuoListShow",function(){location.search.indexOf("naviTashuoList=1")>0&&setTimeout(function(){o.smoothScroll(e.$el.offset().top-40,1)},300)}),a(".BK-after-content-wrapper").on("toggleShow",function(){e.getData(t),e.voice&&s.qAll("20004433")})},getData:function(t){if(!this.isGetData){var e=this,i={lemmaId:t.lemmaId,limit:this.miniCount},n=page.baseUrl||"",o=n+"/api/tashuo/gettashuolist";a.ajax({url:o,type:"GET",dataType:"json",data:i,success:function(t){0===t.errno&&(t.data&&t.data.length>0&&(e.isGetData=!0,e.data=t.data,e.setElements(),e.bindEvents(),e.compileDataToHtml(),s.q2("20008016")),t.tagList&&t.tagList.length>0&&e.createTags(t.tagList))}})}},setElements:function(){this.$items=this.$el.find(".J-items"),this.$more=this.$el.find(".J-more")},bindEvents:function(){var t=this;this.$items.on("click",".J-content-link",function(){s.q2("20008017")}),t.$el.find(".J-go-essence").on("click",function(){s.qAll("20008018")})},compileDataToHtml:function(){var t=this;this.$el.show(),this.$el.trigger("tashuoListShow"),this.$items.html(c.fetch({items:this.data,lemmaId:this.lemmaId,baseUrl:page.baseUrl,voice:t.voice,tashuoStyle:this.config.tashuoStyle}));var e=this.$items.find(".J-item");e.each(function(e){var i=a(this);new m.TashuoItem(i,t.data[e],"list")}),this.$items.show(),t.inTashuoStyle&&e.length<this.miniCount&&t.$el.find(".J-go-essence").hide();var i=navigator.userAgent;(/H8/.test(i)||/H8S/.test(i)||/S2/.test(i)||/S1/.test(i)||/H9/.test(i)||/H10/.test(i)||/Kids/.test(i)||/Coolpad 5200S/.test(i)||/S10_JTYL/.test(i)||/HUAWEI G750-T20/.test(i)||/HUAWEI G750-T01/.test(i)||/GT-N7102/.test(i)||/vivo Y22L/.test(i)||/vivo X3L/.test(i)||/SM-N7506V/.test(i)||/Lenovo A788t/.test(i)||/HUAWEI G521-L076/.test(i)||/GT-I9158V/.test(i)||/EBEN T7/.test(i))&&a(".audio-play").hide()},createTags:function(t){var e=a("#tashuo_list_tag_content"),i=new n('<span>\n{%foreach $items as $index=>$item%}\n<a {%if $index === 0%} class="current-tab" {%/if%} href="{%$baseUrl|f_escape_xml%}/tashuolist/{%$lemmaTitle|f_escape_path%}/{%$lemmaId|f_escape_path%}?fromLemmaModule=list&fromLemmaTitle={%$lemmaTitle|f_escape_path%}&fromLemmaId={%$lemmaId|f_escape_path%}&fromTagId={%$item.tagId|f_escape_path%}">{%$item.tagName|f_escape_xml%}</a>\n{%/foreach%}\n</span>');a("#tashuo_list_tag").show(),e.html(i.fetch({items:t,lemmaId:this.lemmaId,lemmaTitle:this.config.lemmaTitle,baseUrl:page.baseUrl})),e.width(e.children().width()+10),new l("#tashuo_list_tag",{scrollX:!0,scrollY:!1,preventDefault:!1})}};i.exports={init:function(t){h.init(t||{})}}});})(window._SF_ ? _SF_.page : window.page);
;(function (page){ var define = page.define; var require = page.require; define("wiki-mobile-lemma:widget/tashuo/tags/tags.js",function(t,a){var e=t("wiki-mobile-common:widget/lib/zepto/zepto.js"),i=t("wiki-mobile-common:widget/util/nslog.js"),n=t("wiki-mobile-common:widget/lib/jsmart/jsmart.js"),s=t("wiki-mobile-common:widget/util/cookie.js"),h=e(".BK-main-content"),o=new n('<div class="tashuo-tag J-tashuo-tag">\n<div class="tashuo-tag-el J-item">\n<div class="tashuo-tag-button"><span>{%$items.length|f_escape_xml%}条TA说</span><i><img src="{%\'http://imgsrc.baidu.com/baike/pic/item/\'|cat:$items[0].src|cat:\'.jpg\'|wiki_common_https_trans%}" /></i></div>\n</div>\n</div>'),l=new n('<div class="tashuo-tag-tip J-tip">\n<div class="tashuo-tag-tip-content"><div class="tashuo-tag-tip-max"></div><i></i></div>\n<div class="tashuo-tag-tip-min"></div>\n</div>'),r={},d={h2TagName:"h2.title-level-2",h3TagName:"h3.title-level-3",titleItems:[],paths:null,tagId:0,$noTailTitle1:null,init:function(t){var t=t||{};this.isLastScreen=t.isLastScreen,this.sliceHtml(t.contentHtml)},sliceHtml:function(t){var a=this,i=[];return e.each(t,function(){var t=e(this);(t.is(a.h2TagName)||t.is(a.h3TagName))&&i.push(e(this))}),0===i.length?void(this.isLastScreen&&this.processLastItem()):(this.titleItems=this.titleItems.concat(i),void this.insertTags())},insertTags:function(){var t=this;if(e.each(this.titleItems,function(a,e){if(e.is(t.h2TagName))if(t.$noTailTitle1){var i=t.getHeader1TagData(t.$noTailTitle1);i&&t.insertTag(i.header1,e,!0),t.$noTailTitle1=e}else t.$noTailTitle1=e;if(e.is(t.h3TagName)&&a<t.titleItems.length-1){var i=t.getHeader2TagData(t.$noTailTitle1,e);i&&t.insertTag(i,t.titleItems[a+1])}}),this.isLastScreen)return void this.processLastItem();var a=this.titleItems[this.titleItems.length-1];this.titleItems=[],a.is(this.h3TagName)&&this.titleItems.push(a)},processLastItem:function(){var t=this.titleItems[this.titleItems.length-1],a=null,e=null;this.$noTailTitle1?(a=this.getHeader1TagData(this.$noTailTitle1),t&&t.is(this.h3TagName)&&(e=this.getHeader2TagData(this.$noTailTitle1,t))):t&&(e=this.getHeader2TagData(this.$noTailTitle1,t)),this.appendTagToContent(a,e)},getHeader1TagData:function(t){var a=null;return e.each(this.paths,function(e,i){return i.header1&&i.header1.name===t.data("title")?(a=i,!1):void 0}),a},getHeader2TagData:function(t,a){if(t){var i=this.getHeader1TagData(t);return i?this.getHeader2Data(i.header2,a):null}var n=this.getHeader2DataWithNoHeader1(),s=null;return e.each(n,function(t,e){return e.name===a.data("title")?(s=e,!1):void 0}),s},getHeader2Data:function(t,a){var i=null;return t&&t.length>0&&e.each(t,function(t,e){return e.name===a.data("title")?(i=e,!1):void 0}),i},getHeader2DataWithNoHeader1:function(){var t=[];return e.each(this.paths,function(a,e){e.header1&&e.header1.name||e.header2&&e.header2.length>0&&t.concat(e.header2)}),t},insertTag:function(t,a,e){var i=[];if(e){var n=a.prev().prev();n.is("div.tashuo-tag")&&(i=r[n.data("tagId")],r[n.data("tagId")]=null,n.remove())}t.data&&(i=t.data.concat(i)),0!==i.length&&a.prev().before(this.createTag(i))},appendTagToContent:function(t,a){var e=[];t&&t.header1.data&&t.header1.data.length>0&&(e=e.concat(t.header1.data)),a&&a.header2.data&&a.header2.data.length>0&&(e=e.concat(a.header2.data)),e.length>0&&h.append(this.createTag(e))},createTag:function(t){var a="tagId"+this.tagId++,n=e(o.fetch({items:t})).data("tagId",a);return n.find(".J-item").data("tagId",a),r[a]=t,s.read("wapbaikeTashuoTag")||n.find(".J-item").prepend(l.fetch()),i.q2("20008001"),n}},g={init:function(){this.bindEvents()},bindEvents:function(){h.on("mainContentLoaded",function(t,a){d.init(a)}),h.on("click",".J-tashuo-tag .J-item",function(){s.write("wapbaikeTashuoTag","closed",168,location.host),h.find(".J-tashuo-tag .J-tip").remove(),h.trigger("tashuoDialog",{tagData:r[e(this).data("tagId")]})})}};a.init=function(t){t.paths&&t.paths.length>0&&(d.paths=t.paths,g.init(t))}});})(window._SF_ ? _SF_.page : window.page);